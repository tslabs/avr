<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>ATMEL: USB device custom actions</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.3 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
  </ul>
</div>
<h1>USB device custom actions<br>
<small>
[<a class="el" href="a00102.html">USB device operating mode configuration</a>,&nbsp;<a class="el" href="a00097.html">USB application configuration</a>]</small>
</h1><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00103.html#g001e2ac8b87be66d9917e330f85c8e44">Usb_sof_action</a>()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00103.html#g702faf374e8fa6f66a3b7b8efd990c54">Usb_wake_up_action</a>()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00103.html#gb89c65a65f7cdd8798357226751d2107">Usb_resume_action</a>()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00103.html#gfd449fcf4a93026cf00f5d4c64685ca3">Usb_suspend_action</a>()&nbsp;&nbsp;&nbsp;nf_usb_stop()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00103.html#g153bd0949cfe508cd7c8e9e803d7b059">Usb_reset_action</a>()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00103.html#g14458cb2f309214b7263228a2a3dea9d">Usb_vbus_on_action</a>()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00103.html#gc40ad51a1af2bac210c3cbe842b6c9f5">Usb_vbus_off_action</a>()&nbsp;&nbsp;&nbsp;nf_usb_stop()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00103.html#g9941b9833daa3d2af957b89385d831a8">Usb_set_configuration_action</a>()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00103.html#gd573f0460a195ae9e4b051e77954adbb">Scsi_start_read_action</a>()&nbsp;&nbsp;&nbsp;Led_ms_read_on()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00103.html#g5061b768b597f652b6f90a286cb49f91">Scsi_stop_read_action</a>()&nbsp;&nbsp;&nbsp;Led_ms_read_off()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00103.html#g122160fdca094da0db8e40401007f1f2">Scsi_start_write_action</a>()&nbsp;&nbsp;&nbsp;Led_ms_write_on()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00103.html#gd69ab94960c8595837ee139d6a1ba3d6">Scsi_stop_write_action</a>()&nbsp;&nbsp;&nbsp;Led_ms_write_off()</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00103.html#g87115186b2421730a22b3e9383d1a6c9">nf_usb_stop</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function perform a last copy tail if required, when USB enters suspend or is disconnected This function may be declared in "conf_usb.h" for "Usb_suspend_action()" and "Usb_vbus_off_action()" /!\ "g_last_log_sector" must be initialized to "0xFFFFFFFF" at startup to avoid spurious writes on during USB plug-in.  <a href="#g87115186b2421730a22b3e9383d1a6c9"></a><br></td></tr>
</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="g001e2ac8b87be66d9917e330f85c8e44"></a><!-- doxytag: member="conf_usb.h::Usb_sof_action" ref="g001e2ac8b87be66d9917e330f85c8e44" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define Usb_sof_action          </td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00139.html#l00221">221</a> of file <a class="el" href="a00139.html">conf_usb.h</a>.</p>

<p>Referenced by <a class="el" href="a00193.html#l00355">usb_general_interrupt()</a>.</p>

</div>
</div><p>
<a class="anchor" name="g702faf374e8fa6f66a3b7b8efd990c54"></a><!-- doxytag: member="conf_usb.h::Usb_wake_up_action" ref="g702faf374e8fa6f66a3b7b8efd990c54" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define Usb_wake_up_action          </td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00139.html#l00222">222</a> of file <a class="el" href="a00139.html">conf_usb.h</a>.</p>

<p>Referenced by <a class="el" href="a00193.html#l00355">usb_general_interrupt()</a>.</p>

</div>
</div><p>
<a class="anchor" name="gb89c65a65f7cdd8798357226751d2107"></a><!-- doxytag: member="conf_usb.h::Usb_resume_action" ref="gb89c65a65f7cdd8798357226751d2107" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define Usb_resume_action          </td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00139.html#l00223">223</a> of file <a class="el" href="a00139.html">conf_usb.h</a>.</p>

<p>Referenced by <a class="el" href="a00193.html#l00355">usb_general_interrupt()</a>.</p>

</div>
</div><p>
<a class="anchor" name="gfd449fcf4a93026cf00f5d4c64685ca3"></a><!-- doxytag: member="conf_usb.h::Usb_suspend_action" ref="gfd449fcf4a93026cf00f5d4c64685ca3" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define Usb_suspend_action          </td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%">&nbsp;&nbsp;&nbsp;nf_usb_stop()</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00139.html#l00224">224</a> of file <a class="el" href="a00139.html">conf_usb.h</a>.</p>

<p>Referenced by <a class="el" href="a00193.html#l00355">usb_general_interrupt()</a>.</p>

</div>
</div><p>
<a class="anchor" name="g153bd0949cfe508cd7c8e9e803d7b059"></a><!-- doxytag: member="conf_usb.h::Usb_reset_action" ref="g153bd0949cfe508cd7c8e9e803d7b059" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define Usb_reset_action          </td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00139.html#l00225">225</a> of file <a class="el" href="a00139.html">conf_usb.h</a>.</p>

<p>Referenced by <a class="el" href="a00193.html#l00355">usb_general_interrupt()</a>.</p>

</div>
</div><p>
<a class="anchor" name="g14458cb2f309214b7263228a2a3dea9d"></a><!-- doxytag: member="conf_usb.h::Usb_vbus_on_action" ref="g14458cb2f309214b7263228a2a3dea9d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define Usb_vbus_on_action          </td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00139.html#l00226">226</a> of file <a class="el" href="a00139.html">conf_usb.h</a>.</p>

<p>Referenced by <a class="el" href="a00185.html#l00196">usb_device_task()</a>.</p>

</div>
</div><p>
<a class="anchor" name="gc40ad51a1af2bac210c3cbe842b6c9f5"></a><!-- doxytag: member="conf_usb.h::Usb_vbus_off_action" ref="gc40ad51a1af2bac210c3cbe842b6c9f5" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define Usb_vbus_off_action          </td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%">&nbsp;&nbsp;&nbsp;nf_usb_stop()</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00139.html#l00227">227</a> of file <a class="el" href="a00139.html">conf_usb.h</a>.</p>

<p>Referenced by <a class="el" href="a00185.html#l00196">usb_device_task()</a>.</p>

</div>
</div><p>
<a class="anchor" name="g9941b9833daa3d2af957b89385d831a8"></a><!-- doxytag: member="conf_usb.h::Usb_set_configuration_action" ref="g9941b9833daa3d2af957b89385d831a8" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define Usb_set_configuration_action          </td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00139.html#l00228">228</a> of file <a class="el" href="a00139.html">conf_usb.h</a>.</p>

<p>Referenced by <a class="el" href="a00191.html#l00222">usb_set_configuration()</a>.</p>

</div>
</div><p>
<a class="anchor" name="gd573f0460a195ae9e4b051e77954adbb"></a><!-- doxytag: member="conf_usb.h::Scsi_start_read_action" ref="gd573f0460a195ae9e4b051e77954adbb" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define Scsi_start_read_action          </td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%">&nbsp;&nbsp;&nbsp;Led_ms_read_on()</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00139.html#l00242">242</a> of file <a class="el" href="a00139.html">conf_usb.h</a>.</p>

<p>Referenced by <a class="el" href="a00171.html#l00138">scsi_decode_command()</a>.</p>

</div>
</div><p>
<a class="anchor" name="g5061b768b597f652b6f90a286cb49f91"></a><!-- doxytag: member="conf_usb.h::Scsi_stop_read_action" ref="g5061b768b597f652b6f90a286cb49f91" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define Scsi_stop_read_action          </td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%">&nbsp;&nbsp;&nbsp;Led_ms_read_off()</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00139.html#l00243">243</a> of file <a class="el" href="a00139.html">conf_usb.h</a>.</p>

<p>Referenced by <a class="el" href="a00171.html#l00138">scsi_decode_command()</a>.</p>

</div>
</div><p>
<a class="anchor" name="g122160fdca094da0db8e40401007f1f2"></a><!-- doxytag: member="conf_usb.h::Scsi_start_write_action" ref="g122160fdca094da0db8e40401007f1f2" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define Scsi_start_write_action          </td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%">&nbsp;&nbsp;&nbsp;Led_ms_write_on()</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00139.html#l00244">244</a> of file <a class="el" href="a00139.html">conf_usb.h</a>.</p>

<p>Referenced by <a class="el" href="a00171.html#l00138">scsi_decode_command()</a>.</p>

</div>
</div><p>
<a class="anchor" name="gd69ab94960c8595837ee139d6a1ba3d6"></a><!-- doxytag: member="conf_usb.h::Scsi_stop_write_action" ref="gd69ab94960c8595837ee139d6a1ba3d6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define Scsi_stop_write_action          </td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%">&nbsp;&nbsp;&nbsp;Led_ms_write_off()</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00139.html#l00245">245</a> of file <a class="el" href="a00139.html">conf_usb.h</a>.</p>

<p>Referenced by <a class="el" href="a00171.html#l00138">scsi_decode_command()</a>.</p>

</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="g87115186b2421730a22b3e9383d1a6c9"></a><!-- doxytag: member="conf_usb.h::nf_usb_stop" ref="g87115186b2421730a22b3e9383d1a6c9" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void nf_usb_stop           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function perform a last copy tail if required, when USB enters suspend or is disconnected This function may be declared in "conf_usb.h" for "Usb_suspend_action()" and "Usb_vbus_off_action()" /!\ "g_last_log_sector" must be initialized to "0xFFFFFFFF" at startup to avoid spurious writes on during USB plug-in. 
<p>
=&gt; Don't forget to eject (windows) the peripheral from the PC before unpluggin it to avoid uncomplete writing (FAT not actualized)<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>none</em>&nbsp;</td><td></td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>none </dd></dl>

<p>Definition at line <a class="el" href="a00163.html#l02053">2053</a> of file <a class="el" href="a00163.html">nf_mngt.c</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l02054"></a>02054 {
<a name="l02055"></a>02055 <span class="preprocessor">#if (NF_XMCR_MODULE_SHARED == ENABLED)</span>
<a name="l02056"></a>02056 <span class="preprocessor"></span>   <a class="code" href="a00060.html#2888ee8b7b2aad2f3e86eeff599729ca" title="Enable the XMCR (Extending Memory Module) of the AVR to drive the NAND Flash.">nf_XMCR_enable</a>();
<a name="l02057"></a>02057 <span class="preprocessor">#endif</span>
<a name="l02058"></a>02058 <span class="preprocessor"></span>
<a name="l02059"></a>02059    <span class="keywordflow">if</span> ( 0xFFFFFFFF!=<a class="code" href="a00062.html#2bc0562eb7d70332b01be5df48432466">g_last_log_sector</a> )
<a name="l02060"></a>02060    {
<a name="l02061"></a>02061       <a class="code" href="a00035.html#7910d3cc3f9fafe153dc5a7c9b93b114" title="Function linker for NF access indications.">Nf_access_signal_on</a>();
<a name="l02062"></a>02062       <a class="code" href="a00062.html#a38cbc2641b27ca8fe33b40dbfdd7486">nf_copy_tail</a>();
<a name="l02063"></a>02063 
<a name="l02064"></a>02064       <span class="keywordflow">if</span> ( <a class="code" href="a00032.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>==<a class="code" href="a00062.html#34b0c74ff891c7c0b314cc27a7fb1307">g_cache_lut</a>.<a class="code" href="a00002.html#afb99de7ef6fcb1b033ecda78ea6de3d">ctrl</a>.<a class="code" href="a00002.html#437f7770ddf9f42e886ac70d2d4febdd">dirty</a> )
<a name="l02065"></a>02065       { 
<a name="l02066"></a>02066          <a class="code" href="a00062.html#c029fba5c62db088a077b69802d61f91" title="Flushes the LUT cache into a new LUT entry.">nf_cache_lut_flush</a>();
<a name="l02067"></a>02067          <a class="code" href="a00062.html#a41b7176d88738a2110b2f2e840f73ac" title="Reload the LUT cache memory, starting from the specified logical block number given...">nf_cache_lut_refill</a>(0);
<a name="l02068"></a>02068       }
<a name="l02069"></a>02069       <span class="keywordflow">if</span> ( <a class="code" href="a00032.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>==<a class="code" href="a00062.html#7a88492231eef53d1724201b68b964bd">g_cache_fbb</a>.<a class="code" href="a00001.html#a5e466ecf8a6e66c3ba4aa6228eccbd5">ctrl</a>.<a class="code" href="a00001.html#8435e2b050da6630b6f0798591d1501f">dirty</a> )
<a name="l02070"></a>02070       {
<a name="l02071"></a>02071          <a class="code" href="a00062.html#4eb467f47ee05e8b863e8da657db4c2f" title="Flushes the FBB cache into a new FBB entry.">nf_cache_fbb_flush</a>( <a class="code" href="a00032.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a> );
<a name="l02072"></a>02072          <a class="code" href="a00062.html#524dde7169bece3f9ce79e1c56d7412b" title="Reload the FBB cache memory, starting from 0.">nf_cache_fbb_refill</a>();
<a name="l02073"></a>02073       }
<a name="l02074"></a>02074       <a class="code" href="a00035.html#e0aa07db9a17dbf56fd7c287c9a4aeac">Nf_access_signal_off</a>();
<a name="l02075"></a>02075    }
<a name="l02076"></a>02076 
<a name="l02077"></a>02077 <span class="preprocessor">#if (NF_XMCR_MODULE_SHARED == ENABLED)</span>
<a name="l02078"></a>02078 <span class="preprocessor"></span>   <a class="code" href="a00060.html#6008aafe936bca7bfc39a8db231c1e7b" title="Disable the XMCR module of the AVR, to allow access to others peripherals that may...">nf_XMCR_disable</a>();
<a name="l02079"></a>02079 <span class="preprocessor">#endif</span>
<a name="l02080"></a>02080 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Sep 14 13:14:24 2009 for ATMEL by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.3 </small></address>
</body>
</html>
