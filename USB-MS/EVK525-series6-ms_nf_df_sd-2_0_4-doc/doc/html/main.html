<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>ATMEL: EVK525 AT90USBxxx USB Mass storage</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.3 -->
<div class="tabs">
  <ul>
    <li class="current"><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
  </ul>
</div>
<h1>EVK525 AT90USBxxx USB Mass storage</h1>
<p>
<h2><a class="anchor" name="intro">
License</a></h2>
Use of this program is subject to Atmel's End User License Agreement.<p>
Please read file lic_page for copyright notice.<h2><a class="anchor" name="install">
Description</a></h2>
This embedded application source code illustrates how to implement a USB mass storage application with the AT90USBxxx controller on STK525 development board, using the add-on board EVK525. Please read the EVK525 User Hardware Guide before connecting the EVK525 to STK525, and before using this program. The application enumerates as a Mass Storage device containing 3 Logical Units (LUN) :<ul>
<li>SD/MMC interface, size depends on user's card (EVK525)</li><li>NAND Flash device, 256 MBytes by default, but user can add others devices (EVK525). The NandFlash suppoted listing is availabled <a href="../../at90usb128/lib_mem/nf/support_NF_Driver_AVR.pdf">here</a>.</li><li>DataFlash device, 4 MBytes (STK525)</li></ul>
<h2><a class="anchor" name="Revision">
Revision</a></h2>
<dl class="user" compact><dt><b>V2.0.4</b></dt><dd></dd></dl>
USB Device:<ul>
<li>Fix bug about back drive voltage on D+ after VBus disconnect (USB Certification)</li><li>Remove VBus interrupt and manage VBus state by pooling</li><li>Fix bug during attach (the interrupt must be disable during attach to don't freeze clock)</li><li>MassStorageClass :<ul>
<li>Fix error in sense command to support Vista and Windows Seven</li><li>Add write Protect Management under MAC OS</li><li>Improve MSC compliance</li><li>Add MSC compliance with Linux 2.4 kernel</li></ul>
</li></ul>
<p>
SD/MMC driver:<ul>
<li>Fix SD/MMC driver initialization</li></ul>
<p>
NandFlash driver:<ul>
<li>Add support NAND512W3A2C</li></ul>
<p>
<dl class="user" compact><dt><b>V2.0.3</b></dt><dd></dd></dl>
USB Stack<ul>
<li>Improve USB protocol to have a USB chap9 and MSC compliance</li></ul>
<p>
Fix error on DataFlash driver<p>
Fix error on MMC/SD driver<p>
<dl class="user" compact><dt><b>V2.0.2</b></dt><dd></dd></dl>
NandFlash driver :<ul>
<li>add feature 2xCS</li><li>new CLE/ALE pin management to fix error on specific NF references</li></ul>
<p>
USB Stack:<ul>
<li>Move VBus interrupt to VBus pooling</li><li>Fix USB constant about Device Status</li><li>Add three possibilities for SN on USB : No SN, Constant SN, Unique SN</li></ul>
<p>
<dl class="user" compact><dt><b>V2.0.1</b></dt><dd></dd></dl>
NandFlash driver :<ul>
<li>fix major bug</li><li>Add listing NandFlash support</li></ul>
<p>
USB Stack :<ul>
<li>Fix inquiry command</li><li>add global define constante</li><li>clean and fix specific request</li><li>Fix endpoint array size</li><li>Optimized power consumption issue in device selpowered mode: -freeze clock when ubs not connected Improvement comments</li></ul>
<p>
<dl class="user" compact><dt><b>V2.0.0 and before</b></dt><dd></dd></dl>
Don't used this package, because include a major bug on NandFlash driver. (e.g: old package "at90usb128-evk525-demo-storage-df-nf-sdmmc-1_0_0")<h2><a class="anchor" name="arch">
Architecture</a></h2>
As illustrated in the figure bellow, the application entry point is located is the <a class="el" href="a00052.html">main.c</a> file. The main function first performs the initialization of a scheduler module and then runs it in an infinite loop. The scheduler is a simple infinite loop calling all its tasks defined in the <a class="el" href="a00036.html">conf_scheduler.h</a> file. No real time schedule is performed, when a task ends, the scheduler calls the next task defined in the configuration file (<a class="el" href="a00036.html">conf_scheduler.h</a>).<p>
The application is based on two different tasks:<ul>
<li>The usb_task (<a class="el" href="a00092.html">usb_task.c</a> associated source file), is the task performing the USB low level enumeration process in device mode or host mode.</li><li>The storage task performs SCSI bulk only protocol decoding and performs flash memory access for device mass storage operation calling hardware specific drivers (SD/MMC, NAND Flash, DataFlash). </li></ul>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Sep 14 13:14:17 2009 for ATMEL by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.3 </small></address>
</body>
</html>
