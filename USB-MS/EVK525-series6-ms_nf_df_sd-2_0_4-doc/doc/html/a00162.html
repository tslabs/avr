<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>ATMEL: nf_drv.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.3 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
  </ul>
</div>
<h1>nf_drv.h</h1><a href="a00061.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*This file is prepared for Doxygen automatic documentation generation.*/</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="comment">/* Copyright (c) 2009 Atmel Corporation. All rights reserved.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * Redistribution and use in source and binary forms, with or without</span>
<a name="l00019"></a>00019 <span class="comment"> * modification, are permitted provided that the following conditions are met:</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * 1. Redistributions of source code must retain the above copyright notice,</span>
<a name="l00022"></a>00022 <span class="comment"> * this list of conditions and the following disclaimer.</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> * 2. Redistributions in binary form must reproduce the above copyright notice,</span>
<a name="l00025"></a>00025 <span class="comment"> * this list of conditions and the following disclaimer in the documentation</span>
<a name="l00026"></a>00026 <span class="comment"> * and/or other materials provided with the distribution.</span>
<a name="l00027"></a>00027 <span class="comment"> *</span>
<a name="l00028"></a>00028 <span class="comment"> * 3. The name of Atmel may not be used to endorse or promote products derived</span>
<a name="l00029"></a>00029 <span class="comment"> * from this software without specific prior written permission.</span>
<a name="l00030"></a>00030 <span class="comment"> *</span>
<a name="l00031"></a>00031 <span class="comment"> * 4. This software may only be redistributed and used in connection with an Atmel</span>
<a name="l00032"></a>00032 <span class="comment"> * AVR product.</span>
<a name="l00033"></a>00033 <span class="comment"> *</span>
<a name="l00034"></a>00034 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY ATMEL "AS IS" AND ANY EXPRESS OR IMPLIED</span>
<a name="l00035"></a>00035 <span class="comment"> * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF</span>
<a name="l00036"></a>00036 <span class="comment"> * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT ARE EXPRESSLY AND</span>
<a name="l00037"></a>00037 <span class="comment"> * SPECIFICALLY DISCLAIMED. IN NO EVENT SHALL ATMEL BE LIABLE FOR ANY DIRECT,</span>
<a name="l00038"></a>00038 <span class="comment"> * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span>
<a name="l00039"></a>00039 <span class="comment"> * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span>
<a name="l00040"></a>00040 <span class="comment"> * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</span>
<a name="l00041"></a>00041 <span class="comment"> * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00042"></a>00042 <span class="comment"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF</span>
<a name="l00043"></a>00043 <span class="comment"> * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00044"></a>00044 <span class="comment"> */</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="preprocessor">#ifndef _NFC_DRV_H_</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span><span class="preprocessor">#define _NFC_DRV_H_</span>
<a name="l00049"></a>00049 <span class="preprocessor"></span>
<a name="l00050"></a>00050 <span class="preprocessor">#undef _GLOBEXT_</span>
<a name="l00051"></a>00051 <span class="preprocessor"></span><span class="preprocessor">#if (defined _nfc_drv_c_)</span>
<a name="l00052"></a>00052 <span class="preprocessor"></span><span class="preprocessor">#  define _GLOBEXT_</span>
<a name="l00053"></a>00053 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00054"></a><a class="code" href="a00061.html#d4d03be3b8f3d15ed804170a1311ec98">00054</a> <span class="preprocessor"></span><span class="preprocessor">#  define _GLOBEXT_ extern</span>
<a name="l00055"></a>00055 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span>
<a name="l00057"></a>00057 <span class="comment">//====FOR COMPATIBILITY WITH AVR (no DFC)==</span>
<a name="l00058"></a><a class="code" href="a00061.html#a05075e4b708516ca1110b771bd9cb09">00058</a> <span class="preprocessor">#define  CLK_DFC_NFC_40MHz             0</span>
<a name="l00059"></a><a class="code" href="a00061.html#25a92b5bbf698539fbeee69d50987bb1">00059</a> <span class="preprocessor"></span><span class="preprocessor">#define  CLK_DFC_NFC_30MHz             0</span>
<a name="l00060"></a><a class="code" href="a00061.html#1ac5f27e619c47e98fa275fc3298a314">00060</a> <span class="preprocessor"></span><span class="preprocessor">#define  CLK_DFC_NFC_24MHz             0</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span><span class="comment">//=========================================</span>
<a name="l00062"></a>00062 
<a name="l00066"></a><a class="code" href="a00121.html#gc89efdcfc7482ffdd7fed7cb558e8520">00066</a> <span class="preprocessor">#define NFC_ACT_NOP        0 </span>
<a name="l00067"></a><a class="code" href="a00121.html#g7fac080c5cd6ef2e4488ccabd602dc29">00067</a> <span class="preprocessor">#define NFC_ACT_DEV_SELECT 1 </span>
<a name="l00068"></a><a class="code" href="a00121.html#g2ab3804d96fbea4a2728c2dfe1ebcf4a">00068</a> <span class="preprocessor">#define NFC_ACT_READ       2 </span>
<a name="l00069"></a><a class="code" href="a00121.html#g3037aaf82a54bdefac7b263e98c87563">00069</a> <span class="preprocessor">#define NFC_ACT_WRITE      3 </span>
<a name="l00070"></a><a class="code" href="a00121.html#g5f95acd6c54e424dfa198abf6eedb8bd">00070</a> <span class="preprocessor">#define NFC_ACT_ASSERT_CE  4 </span>
<a name="l00071"></a><a class="code" href="a00121.html#g7fbd6608a2f650f008c0bc0bfdfe29df">00071</a> <span class="preprocessor">#   define NFC_EXT_CELOW     1</span>
<a name="l00072"></a><a class="code" href="a00121.html#g7adf6f14ec58a9b01e5cdbd9c2692c07">00072</a> <span class="preprocessor"></span><span class="preprocessor">#   define NFC_EXT_NOP       0</span>
<a name="l00073"></a><a class="code" href="a00121.html#g87223158c7a8ae1e77bf9c055a02c277">00073</a> <span class="preprocessor"></span><span class="preprocessor">#define NFC_ACT_STOP       5 </span>
<a name="l00074"></a><a class="code" href="a00121.html#gab34d75dd084ac97e29f53ca9e7b9b5a">00074</a> <span class="preprocessor">#define NFC_ACT_ADC_EXT    6 </span>
<a name="l00075"></a>00075 <span class="preprocessor"></span>
<a name="l00076"></a>00076 <span class="preprocessor"></span>
<a name="l00077"></a>00077 <span class="preprocessor"></span><span class="comment">//************************** XMCR Addresses *********************</span>
<a name="l00078"></a>00078 <span class="comment">//************ A13  A12  A11  A10  A9   A8   </span>
<a name="l00079"></a>00079 <span class="comment">//************ PC5  PC4  PC3  PC2  PC1  PC0  </span>
<a name="l00080"></a>00080 <span class="comment">//************ CS3  CS2  CS1  CS0  ALE  CLE  </span>
<a name="l00081"></a>00081 <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00082"></a>00082 <span class="comment">//************  1    1    x    x    1    0   | ADD_LATCH</span>
<a name="l00083"></a>00083 <span class="comment">//************  1    1    x    x    0    1   | CMD_LATCH</span>
<a name="l00084"></a>00084 <span class="comment">//************  1    1    x    x    0    0   | CMD_DATA</span>
<a name="l00085"></a>00085 <span class="comment">// We need to set bits A13:12 to get an address &gt; 0x2100 (=external memory)</span>
<a name="l00086"></a>00086 <span class="comment">// (these lines are not physically addressed no NF3 and NF4</span>
<a name="l00087"></a>00087 <span class="comment">// The CS0 and CS1 are drived by manual pin IO control</span>
<a name="l00088"></a>00088 <span class="comment">// The ALE and CLE may be drived by manual pin IO control (see define NF_CLE_ALE_MANUAL in conf_nf.h)</span>
<a name="l00089"></a><a class="code" href="a00061.html#52171333a19206727fd5cf8dd22764a1">00089</a> <span class="preprocessor">#define  NF_ADD_LATCH_ENABLE_ADD       0x3A00    // Address Latch Enable Address</span>
<a name="l00090"></a><a class="code" href="a00061.html#b25def4db76056c0fb628017a8745cb9">00090</a> <span class="preprocessor"></span><span class="preprocessor">#define  NF_CMD_LATCH_ENABLE_ADD       0x3900    // Command Latch Enable Address</span>
<a name="l00091"></a><a class="code" href="a00061.html#2c64a0b3ce78ea21cc2b1a6d1c881011">00091</a> <span class="preprocessor"></span><span class="preprocessor">#define  NF_ADDRESS_CMD_DATA           0x3800    // Command / Data Address register</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span>
<a name="l00093"></a>00093 
<a name="l00094"></a>00094 <span class="comment">/************************** Low Level routines *****************************/</span>
<a name="l00095"></a><a class="code" href="a00061.html#6a8a6e712a6de87b4b0a4ab60882ddbe">00095</a> <span class="preprocessor">#  define  Nf_rd_byte()                  (nf_data)</span>
<a name="l00096"></a><a class="code" href="a00061.html#85fc4d411042026af1416b523e51470f">00096</a> <span class="preprocessor"></span><span class="preprocessor">#  define  Nf_wr_byte(b)                 (nf_data = b)</span>
<a name="l00097"></a>00097 <span class="preprocessor"></span><span class="preprocessor">#if (NF_CLE_ALE_MANUAL == ENABLED)</span>
<a name="l00098"></a><a class="code" href="a00061.html#eaf9a582fe49f76b6a5f0500b4f3bf69">00098</a> <span class="preprocessor"></span><span class="preprocessor">#  define  Nf_send_command(command)      {Nandflash_CLE_select(); nf_send_cmd = command; Nandflash_CLE_unselect(); }</span>
<a name="l00099"></a><a class="code" href="a00061.html#665fae37ff62a2e59e4a71a50953fe91">00099</a> <span class="preprocessor"></span><span class="preprocessor">#  define  Nf_send_address(address)      {Nandflash_ALE_select(); nf_send_add = address; Nandflash_ALE_unselect(); }</span>
<a name="l00100"></a>00100 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00101"></a>00101 <span class="preprocessor"></span><span class="preprocessor">#  define  Nf_send_command(command)      (nf_send_cmd = command)</span>
<a name="l00102"></a>00102 <span class="preprocessor"></span><span class="preprocessor">#  define  Nf_send_address(address)      (nf_send_add = address)</span>
<a name="l00103"></a>00103 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00104"></a>00104 <span class="preprocessor"></span>
<a name="l00105"></a>00105 <span class="comment">// Compatibility with other firmware prototypes</span>
<a name="l00106"></a><a class="code" href="a00061.html#91d42d1de5452067661da571363724c8">00106</a> <span class="preprocessor">#define  Mcu_set_sfr_page_nfc()</span>
<a name="l00107"></a><a class="code" href="a00061.html#50a2c8add5233b65d9c537baf4fe5be0">00107</a> <span class="preprocessor"></span><span class="preprocessor">#define  Nfc_set_cmd(command)          Nf_send_command(command)</span>
<a name="l00108"></a><a class="code" href="a00061.html#ce78f62128d4b37a7cdf14a58fd4606a">00108</a> <span class="preprocessor"></span><span class="preprocessor">#define  Nfc_rd_status()               Nf_rd_byte()      // once the STATUS cmd has been sent, all read commands will read the status</span>
<a name="l00109"></a><a class="code" href="a00061.html#3a9602476f480441b912a7de88d440ed">00109</a> <span class="preprocessor"></span><span class="preprocessor">#define  Nfc_rd_data()                 Nf_rd_byte()</span>
<a name="l00110"></a><a class="code" href="a00061.html#e7884626d24995c0dcf00140639cd6d4">00110</a> <span class="preprocessor"></span><span class="preprocessor">#define  Nfc_rd_data_fetch_next()      Nf_rd_byte()</span>
<a name="l00111"></a><a class="code" href="a00061.html#a2f2068df9c25227a31bce91dabfcaa2">00111</a> <span class="preprocessor"></span><span class="preprocessor">#define  Nfc_wr_data(dat)              Nf_wr_byte(dat)</span>
<a name="l00112"></a><a class="code" href="a00061.html#97ed1acd5b7fe680c9516a9b282e723b">00112</a> <span class="preprocessor"></span><span class="preprocessor">#define  Nfc_set_adc(adr)              Nf_send_address(adr)</span>
<a name="l00113"></a><a class="code" href="a00061.html#214acfde9f6acc02adb0bb06e2c28a80">00113</a> <span class="preprocessor"></span><span class="preprocessor">#define  Nfc_set_adr(adr)              Nf_send_address(adr)</span>
<a name="l00114"></a><a class="code" href="a00061.html#ac6eab632f7d904222094b7994cda033">00114</a> <span class="preprocessor"></span><span class="preprocessor">#define  Nfc_unprotect_all_flash()          // assumes that memories are not write protected</span>
<a name="l00115"></a>00115 <span class="preprocessor"></span><span class="comment">//#define  Nfc_wait_cache_busy()         nfc_wait_busy()    // declared below</span>
<a name="l00116"></a><a class="code" href="a00061.html#929956d7ddddc291d7af26dea3159401">00116</a> <span class="preprocessor">#define  Nfc_action(a,b)               { if( a == NFC_ACT_DEV_SELECT ) nfc_select_dev(b); }</span>
<a name="l00117"></a><a class="code" href="a00061.html#0d84ba3390ed57d612c9b3cbc6c04286">00117</a> <span class="preprocessor"></span><span class="preprocessor">#define  nfc_init(a,b)                 nf_XMCR_enable()</span>
<a name="l00118"></a><a class="code" href="a00061.html#65a33d3164a890cef47c163e613e9c7e">00118</a> <span class="preprocessor"></span><span class="preprocessor">#define  Nfc_get_ecc()                 (0xFF)</span>
<a name="l00119"></a><a class="code" href="a00061.html#1e6a89fab3f44fcdf627a615423711c8">00119</a> <span class="preprocessor"></span><span class="preprocessor">#define  Nfc_init_ecc()</span>
<a name="l00120"></a>00120 <span class="preprocessor"></span>
<a name="l00121"></a>00121 
<a name="l00122"></a>00122 
<a name="l00132"></a><a class="code" href="a00061.html#c8447f3352f9d30b0a9eb506378d3cc9">00132</a> <span class="preprocessor">#define  Nfc_open_page_read( page_addr, byte_addr)               \</span>
<a name="l00133"></a>00133 <span class="preprocessor">   if ( Is_nf_512() ) </span><span class="comment">/* 512B pages */</span>                     \
<a name="l00134"></a>00134    {                                                       \
<a name="l00135"></a>00135       if ( (byte_addr)&lt;256 )                               \
<a name="l00136"></a>00136       {                                                    \
<a name="l00137"></a>00137          Nfc_set_cmd(NF_READ_A_AREA_CMD);                  \
<a name="l00138"></a>00138          Nfc_set_adc( LSB( byte_addr) );                   \
<a name="l00139"></a>00139          Nfc_set_adr( LSB0(page_addr) );                   \
<a name="l00140"></a>00140          Nfc_action( NFC_ACT_ASSERT_CE, NFC_EXT_CELOW);    \
<a name="l00141"></a>00141          Nfc_set_adr( LSB1(page_addr) );                   \
<a name="l00142"></a>00142          if ( 3==G_N_ROW_CYCLES )                          \
<a name="l00143"></a>00143          {                                                 \
<a name="l00144"></a>00144             Nfc_set_adr( MSB1(page_addr) );                \
<a name="l00145"></a>00145          }                                                 \
<a name="l00146"></a>00146          nfc_wait_busy();                                  \
<a name="l00147"></a>00147          if(G_CE_TOGGLE)                                   \
<a name="l00148"></a>00148          {  Nfc_action( NFC_ACT_ASSERT_CE, NFC_EXT_NOP);}  \
<a name="l00149"></a>00149       }                                                    \
<a name="l00150"></a>00150       else if ( (byte_addr)&lt;512 )                          \
<a name="l00151"></a>00151       {                                                    \
<a name="l00152"></a>00152          Nfc_set_cmd(NF_READ_B_AREA_CMD);                  \
<a name="l00153"></a>00153          Nfc_set_adc( LSB( byte_addr) );                   \
<a name="l00154"></a>00154          Nfc_action(NFC_ACT_ADC_EXT, 1);                   \
<a name="l00155"></a>00155          Nfc_set_adr( LSB0(page_addr) );                   \
<a name="l00156"></a>00156          Nfc_action( NFC_ACT_ASSERT_CE, NFC_EXT_CELOW);    \
<a name="l00157"></a>00157          Nfc_set_adr( LSB1(page_addr) );                   \
<a name="l00158"></a>00158          if ( 3==G_N_ROW_CYCLES )                          \
<a name="l00159"></a>00159          {                                                 \
<a name="l00160"></a>00160             Nfc_set_adr( MSB1(page_addr) );                \
<a name="l00161"></a>00161          }                                                 \
<a name="l00162"></a>00162          nfc_wait_busy();                                  \
<a name="l00163"></a>00163          if(G_CE_TOGGLE)                                   \
<a name="l00164"></a>00164          {  Nfc_action( NFC_ACT_ASSERT_CE, NFC_EXT_NOP);}  \
<a name="l00165"></a>00165       }                                                    \
<a name="l00166"></a>00166       else                                                 \
<a name="l00167"></a>00167       {                                                    \
<a name="l00168"></a>00168          Nfc_set_cmd(NF_READ_C_AREA_CMD);                  \
<a name="l00169"></a>00169          Nfc_set_adc( LSB( byte_addr) );                   \
<a name="l00170"></a>00170          Nfc_action(NFC_ACT_ADC_EXT, 2);                   \
<a name="l00171"></a>00171          Nfc_set_adr( LSB0(page_addr) );                   \
<a name="l00172"></a>00172          Nfc_action( NFC_ACT_ASSERT_CE, NFC_EXT_CELOW);    \
<a name="l00173"></a>00173          Nfc_set_adr( LSB1(page_addr) );                   \
<a name="l00174"></a>00174          if ( 3==G_N_ROW_CYCLES )                          \
<a name="l00175"></a>00175          {                                                 \
<a name="l00176"></a>00176             Nfc_set_adr( MSB1(page_addr) );                \
<a name="l00177"></a>00177          }                                                 \
<a name="l00178"></a>00178          nfc_wait_busy();                                  \
<a name="l00179"></a>00179          if(G_CE_TOGGLE)                                   \
<a name="l00180"></a>00180          {  Nfc_action( NFC_ACT_ASSERT_CE, NFC_EXT_NOP);}  \
<a name="l00181"></a>00181       }                                                    \
<a name="l00182"></a>00182    }                                                       \
<a name="l00183"></a>00183    if ( Is_nf_2k() ) <span class="comment">/* 2KB pages */</span>                       \
<a name="l00184"></a>00184    {                                                       \
<a name="l00185"></a>00185       Nfc_set_cmd(NF_READ_CMD);                            \
<a name="l00186"></a>00186       Nfc_set_adc( LSB( byte_addr) );                      \
<a name="l00187"></a>00187       Nfc_set_adc( MSB( byte_addr) );                      \
<a name="l00188"></a>00188       Nfc_set_adr( LSB0(page_addr) );                      \
<a name="l00189"></a>00189       Nfc_set_adr( LSB1(page_addr) );                      \
<a name="l00190"></a>00190       if ( 3==G_N_ROW_CYCLES )                             \
<a name="l00191"></a>00191       {                                                    \
<a name="l00192"></a>00192          Nfc_set_adr( MSB1(page_addr) );                   \
<a name="l00193"></a>00193       }                                                    \
<a name="l00194"></a>00194       Nfc_set_cmd(NF_READ_CMD2);                           \
<a name="l00195"></a>00195       nfc_wait_busy();                                     \
<a name="l00196"></a>00196    }                                                       \
<a name="l00197"></a>00197    Nfc_set_cmd(NF_READ_CMD); <span class="comment">/* Back to the read mode */</span>
<a name="l00198"></a>00198 
<a name="l00199"></a>00199 
<a name="l00200"></a>00200 
<a name="l00201"></a>00201 
<a name="l00211"></a><a class="code" href="a00061.html#74dba9394ac015f89cb1c42131a239b5">00211</a> <span class="preprocessor">#define Nfc_open_page_write( page_addr, byte_addr)         \</span>
<a name="l00212"></a>00212 <span class="preprocessor">   Nfc_wait_cache_busy();                                  \</span>
<a name="l00213"></a>00213 <span class="preprocessor">   Nfc_unprotect_all_flash(); </span><span class="comment">/* WP may be actif due to block protection */</span> \
<a name="l00214"></a>00214                                                            \
<a name="l00215"></a>00215    if ( Is_nf_512() ) <span class="comment">/* 512B pages */</span>                     \
<a name="l00216"></a>00216    {                                                       \
<a name="l00217"></a>00217       if ( (byte_addr)&lt;256 )                               \
<a name="l00218"></a>00218       {                                                    \
<a name="l00219"></a>00219          Nfc_set_cmd(NF_READ_A_AREA_CMD);                  \
<a name="l00220"></a>00220          Nfc_set_cmd(NF_SEQUENTIAL_DATA_INPUT_CMD);        \
<a name="l00221"></a>00221          Nfc_set_adc( LSB( byte_addr) );                   \
<a name="l00222"></a>00222          Nfc_set_adr( LSB0(page_addr) );                   \
<a name="l00223"></a>00223          Nfc_set_adr( LSB1(page_addr) );                   \
<a name="l00224"></a>00224          if ( 3==G_N_ROW_CYCLES )                          \
<a name="l00225"></a>00225          {                                                 \
<a name="l00226"></a>00226             Nfc_set_adr( MSB1(page_addr) );                \
<a name="l00227"></a>00227          }                                                 \
<a name="l00228"></a>00228       }                                                    \
<a name="l00229"></a>00229       else if ( (byte_addr)&lt;512 )                          \
<a name="l00230"></a>00230       {                                                    \
<a name="l00231"></a>00231          Nfc_set_cmd(NF_READ_B_AREA_CMD);                  \
<a name="l00232"></a>00232          Nfc_set_cmd(NF_SEQUENTIAL_DATA_INPUT_CMD);        \
<a name="l00233"></a>00233          Nfc_set_adc( LSB( byte_addr) );                   \
<a name="l00234"></a>00234          Nfc_action(NFC_ACT_ADC_EXT, 1);                   \
<a name="l00235"></a>00235          Nfc_set_adr( LSB0(page_addr) );                   \
<a name="l00236"></a>00236          Nfc_set_adr( LSB1(page_addr) );                   \
<a name="l00237"></a>00237          if ( 3==G_N_ROW_CYCLES )                          \
<a name="l00238"></a>00238          {                                                 \
<a name="l00239"></a>00239             Nfc_set_adr( MSB1(page_addr) );                \
<a name="l00240"></a>00240          }                                                 \
<a name="l00241"></a>00241       }                                                    \
<a name="l00242"></a>00242       else                                                 \
<a name="l00243"></a>00243       {                                                    \
<a name="l00244"></a>00244          Nfc_set_cmd(NF_READ_C_AREA_CMD);                  \
<a name="l00245"></a>00245          Nfc_set_cmd(NF_SEQUENTIAL_DATA_INPUT_CMD);        \
<a name="l00246"></a>00246          Nfc_set_adc( LSB( byte_addr) );                   \
<a name="l00247"></a>00247          Nfc_action(NFC_ACT_ADC_EXT, 2);                   \
<a name="l00248"></a>00248          Nfc_set_adr( LSB0(page_addr) );                   \
<a name="l00249"></a>00249          Nfc_set_adr( LSB1(page_addr) );                   \
<a name="l00250"></a>00250          if ( 3==G_N_ROW_CYCLES )                          \
<a name="l00251"></a>00251          {                                                 \
<a name="l00252"></a>00252             Nfc_set_adr( MSB1(page_addr) );                \
<a name="l00253"></a>00253          }                                                 \
<a name="l00254"></a>00254       }                                                    \
<a name="l00255"></a>00255    }                                                       \
<a name="l00256"></a>00256    if ( Is_nf_2k() ) <span class="comment">/* 2KB pages */</span>                       \
<a name="l00257"></a>00257    {                                                       \
<a name="l00258"></a>00258       Nfc_set_cmd(NF_SEQUENTIAL_DATA_INPUT_CMD);           \
<a name="l00259"></a>00259       Nfc_set_adc( LSB( byte_addr) );                      \
<a name="l00260"></a>00260       Nfc_set_adc( MSB( byte_addr) );                      \
<a name="l00261"></a>00261       Nfc_set_adr( LSB0(page_addr) );                      \
<a name="l00262"></a>00262       Nfc_set_adr( LSB1(page_addr) );                      \
<a name="l00263"></a>00263       if ( 3==G_N_ROW_CYCLES )                             \
<a name="l00264"></a>00264       {                                                    \
<a name="l00265"></a>00265          Nfc_set_adr( MSB1(page_addr) );                   \
<a name="l00266"></a>00266       }                                                    \
<a name="l00267"></a>00267    }
<a name="l00268"></a>00268 
<a name="l00269"></a>00269 
<a name="l00270"></a>00270 
<a name="l00271"></a>00271 <span class="comment">//_____ D E C L A R A T I O N ______________________________________________</span>
<a name="l00272"></a>00272 <span class="comment">//                                                      </span>
<a name="l00273"></a>00273 
<a name="l00274"></a><a class="code" href="a00061.html#b55f5bf79b94687e007eeacb266062fa">00274</a> <span class="preprocessor">#define  NF_MAX_DEVICES                2</span>
<a name="l00277"></a>00277 <span class="preprocessor"></span>
<a name="l00278"></a><a class="code" href="a00061.html#83d1efcae1aa727613d7a3cbc642ab5b">00278</a> <span class="preprocessor"></span><span class="preprocessor">#define  NF_MAX_RB_TIMEOUT             0xFF</span>
<a name="l00279"></a>00279 <span class="preprocessor"></span>
<a name="l00280"></a>00280 
<a name="l00284"></a><a class="code" href="a00122.html#gb462ae1b64a27e4a58f80a5d87365a0e">00284</a> <span class="preprocessor">#define  NF_READ_A_AREA_CMD            0x00 </span>
<a name="l00285"></a><a class="code" href="a00122.html#g924be83e972fbe0a20d7597ba63eb898">00285</a> <span class="preprocessor">#define  NF_READ_B_AREA_CMD            0x01 </span>
<a name="l00286"></a><a class="code" href="a00122.html#gdac832d0e197802122f3ed08659eab62">00286</a> <span class="preprocessor">#define  NF_READ_C_AREA_CMD            0x50 </span>
<a name="l00287"></a>00287 <span class="preprocessor"></span>
<a name="l00288"></a><a class="code" href="a00122.html#geba99dc96d78f777d7977d9e635a486d">00288</a> <span class="preprocessor"></span><span class="preprocessor">#define  NF_READ_CMD                   0x00 </span>
<a name="l00289"></a><a class="code" href="a00122.html#ge3b430852969e884286ed0c54484b840">00289</a> <span class="preprocessor">#define  NF_READ_CMD2                  0x30 </span>
<a name="l00290"></a><a class="code" href="a00122.html#g6b3e6f65ed9fb365dc80dd9eea7c7bb5">00290</a> <span class="preprocessor">#define  NF_RANDOM_READ_CMD_C1         0x05 </span>
<a name="l00291"></a><a class="code" href="a00122.html#gb60ea5558934d96fe4e5f690e68c1f39">00291</a> <span class="preprocessor">#define  NF_RANDOM_READ_CMD_C2         0xE0 </span>
<a name="l00292"></a>00292 <span class="preprocessor"></span>
<a name="l00293"></a><a class="code" href="a00122.html#g501ac26cbe74623f2be4889e79ae38d1">00293</a> <span class="preprocessor"></span><span class="preprocessor">#define  NF_READ_ID_CMD                0x90 </span>
<a name="l00294"></a><a class="code" href="a00122.html#g3e6a1b5ac416b2b1aaf4b35d7f0fc1ec">00294</a> <span class="preprocessor">#define  NF_READ_ID2_CMD               0x91 </span>
<a name="l00295"></a>00295 <span class="preprocessor"></span>
<a name="l00296"></a><a class="code" href="a00122.html#g5ff4dc8af5fcac6e451765fbb857129d">00296</a> <span class="preprocessor"></span><span class="preprocessor">#define  NF_RESET_CMD                  0xff </span>
<a name="l00297"></a>00297 <span class="preprocessor"></span>
<a name="l00298"></a><a class="code" href="a00122.html#g2efc28c0b0df3adabc23d63edc27e01c">00298</a> <span class="preprocessor"></span><span class="preprocessor">#define  NF_SEQUENTIAL_DATA_INPUT_CMD  0x80 </span>
<a name="l00299"></a><a class="code" href="a00122.html#gcb67f1eda6e20910614d4ee4e5f16b94">00299</a> <span class="preprocessor">#define  NF_PAGE_PROGRAM_CMD           0x10 </span>
<a name="l00300"></a>00300 <span class="preprocessor"></span>
<a name="l00301"></a><a class="code" href="a00122.html#g135bceb08b1260b0b07f97bc0596528b">00301</a> <span class="preprocessor"></span><span class="preprocessor">#define  NF_RANDOM_DATA_INPUT_CMD      0x85 </span>
<a name="l00302"></a><a class="code" href="a00122.html#g604b8b2d96b64df0d8a4e15dcb574abc">00302</a> <span class="preprocessor">#define  NF_COPY_BACK_CMD              0x35 </span>
<a name="l00303"></a><a class="code" href="a00122.html#g4bd39b96f3be4d842abc784c09b16659">00303</a> <span class="preprocessor">#define  NF_CACHE_PROGRAM_CMD          0x15 </span>
<a name="l00304"></a>00304 <span class="preprocessor"></span>
<a name="l00305"></a><a class="code" href="a00122.html#gac29402cb01e7f1b3bfde047d1d578fa">00305</a> <span class="preprocessor"></span><span class="preprocessor">#define  NF_BLOCK_ERASE_CMD            0x60 </span>
<a name="l00306"></a><a class="code" href="a00122.html#g43f524c57b3ba4c51c9f6bbf92ff90b0">00306</a> <span class="preprocessor">#define  NF_BLOCK_ERASE_CONFIRM_CMD    0xD0 </span>
<a name="l00307"></a>00307 <span class="preprocessor"></span>
<a name="l00308"></a><a class="code" href="a00122.html#g783e21781a180e0fb6ebba10209d6833">00308</a> <span class="preprocessor"></span><span class="preprocessor">#define  NF_READ_STATUS_CMD            0x70 </span>
<a name="l00309"></a>00309 <span class="preprocessor"></span>
<a name="l00310"></a>00310 <span class="preprocessor"></span>
<a name="l00311"></a>00311 <span class="preprocessor"></span>
<a name="l00312"></a>00312 
<a name="l00316"></a><a class="code" href="a00123.html#gb02ffb6b5c399ba4afebedb99aa0691d">00316</a> <span class="preprocessor">#define  NF_MASK_STATUS_FAIL               (1&lt;&lt;0) </span>
<a name="l00317"></a><a class="code" href="a00123.html#gc0f4b42f5c5e79d042e6253733a3e2e5">00317</a> <span class="preprocessor">#define  NF_MASK_STATUS_READY              (1&lt;&lt;6) </span>
<a name="l00318"></a><a class="code" href="a00123.html#g54968ef06beb1735571aa86940b5e24b">00318</a> <span class="preprocessor">#define  NF_MASK_STATUS_T_RDY_2KB          (1&lt;&lt;5) </span>
<a name="l00319"></a><a class="code" href="a00123.html#g67bd7320150ac34c7500aa2933928617">00319</a> <span class="preprocessor">#define  NF_MASK_STATUS_T_RDY_512B         (1&lt;&lt;6) </span>
<a name="l00320"></a>00320 <span class="preprocessor"></span>
<a name="l00321"></a>00321 <span class="preprocessor"></span>
<a name="l00322"></a>00322 <span class="preprocessor"></span>
<a name="l00323"></a>00323 
<a name="l00326"></a><a class="code" href="a00061.html#68e6bb4551fa0bcd18526a39a7b74203">00326</a> <span class="preprocessor">#define Nfc_wait_cache_busy()                                        \</span>
<a name="l00327"></a>00327 <span class="preprocessor">   {                                                                 \</span>
<a name="l00328"></a>00328 <span class="preprocessor">      register int Reg;                                              \</span>
<a name="l00329"></a>00329 <span class="preprocessor">      Nfc_set_cmd(NF_READ_STATUS_CMD);                               \</span>
<a name="l00330"></a>00330 <span class="preprocessor">      Reg = Nfc_rd_status();                                         \</span>
<a name="l00331"></a>00331 <span class="preprocessor">      while( (Nfc_rd_status() &amp; NF_MASK_STATUS_READY)==0 </span><span class="comment">/*busy*/</span> ); \
<a name="l00332"></a>00332       while( (Nfc_rd_status() &amp; NF_MASK_STATUS_READY)==0 <span class="comment">/*busy*/</span> ); \
<a name="l00333"></a>00333    }
<a name="l00334"></a>00334 
<a name="l00335"></a><a class="code" href="a00061.html#d68699283962590b223fb226e78739c5">00335</a> <span class="preprocessor">#define SIZE_PAGE_BYTE                  ((U16)1&lt;&lt;G_SHIFT_PAGE_BYTE)</span>
<a name="l00336"></a><a class="code" href="a00061.html#eb269843d27f183677d85ee457233918">00336</a> <span class="preprocessor"></span><span class="preprocessor">#define SIZE_SECTOR_BYTE                ((U16)1&lt;&lt;S_SHIFT_SECTOR_BYTE)</span>
<a name="l00337"></a><a class="code" href="a00061.html#668da83f591b67adc32d57080a5afa2c">00337</a> <span class="preprocessor"></span><span class="preprocessor">#define SIZE_BLOCK_PAGE                 ((U8)1&lt;&lt;G_SHIFT_BLOCK_PAGE)</span>
<a name="l00338"></a><a class="code" href="a00061.html#ab9745c0e67c22216932ef3333cc9e52">00338</a> <span class="preprocessor"></span><span class="preprocessor">#define SIZE_PAGE_SECTOR                ((U8)1&lt;&lt;(G_SHIFT_PAGE_BYTE - S_SHIFT_SECTOR_BYTE))</span>
<a name="l00339"></a>00339 <span class="preprocessor"></span>
<a name="l00340"></a>00340 <span class="comment">// Spare zone offsets definition</span>
<a name="l00341"></a>00341 <span class="comment">//</span>
<a name="l00342"></a>00342 <span class="comment">//#define NF_SPARE_SIZE                16  // in bytes</span>
<a name="l00343"></a>00343 
<a name="l00344"></a><a class="code" href="a00061.html#1e3d88079128d3118806d979fc2012c0">00344</a> <span class="preprocessor">#define NFC_SPARE_OFST_1_BLK_ID         1</span>
<a name="l00345"></a><a class="code" href="a00061.html#705297c11d74b4291c0f0230f2c85fac">00345</a> <span class="preprocessor"></span><span class="preprocessor">#define NFC_BLK_ID_SYSTEM       0x39    // System block (Font, screen, firmware, ...)</span>
<a name="l00346"></a><a class="code" href="a00061.html#974cae7c6c942b71e22d685bdb3c2107">00346</a> <span class="preprocessor"></span><span class="preprocessor">#define NFC_BLK_ID_SUBLUT       0xE8    // sub-LUT block</span>
<a name="l00347"></a><a class="code" href="a00061.html#add91673c29e209dc3a833ff51713708">00347</a> <span class="preprocessor"></span><span class="preprocessor">#define NFC_BLK_ID_RCV          0x72    // Recovery block</span>
<a name="l00348"></a><a class="code" href="a00061.html#c025edc74717298e57de75859117dc1e">00348</a> <span class="preprocessor"></span><span class="preprocessor">#define NFC_BLK_ID_FBB          0xB4    // Free-blocks block</span>
<a name="l00349"></a><a class="code" href="a00061.html#2e268e2bf7f16ea1e30a5ff354e06fd7">00349</a> <span class="preprocessor"></span><span class="preprocessor">#define NFC_BLK_ID_DATA         0xFF    // Data block (mass storage). Also the default value after an erase</span>
<a name="l00350"></a><a class="code" href="a00061.html#f19a6cf6b26673dc36867d41b8eefed0">00350</a> <span class="preprocessor"></span><span class="preprocessor">#define NFC_BLK_ID_QUARANTINE   0x8D    // Block which encountered an ECC error not recoverable. Not yet bad...</span>
<a name="l00351"></a>00351 <span class="preprocessor"></span>
<a name="l00352"></a><a class="code" href="a00061.html#89ad3db087517a60f80aef41609e1caf">00352</a> <span class="preprocessor">#define NFC_SPARE_OFST_2_BYTE_2         2</span>
<a name="l00353"></a><a class="code" href="a00061.html#a21795d25cf7b6c5fe5d5e205cac92b2">00353</a> <span class="preprocessor"></span><span class="preprocessor">#define NFC_SPARE_OFST_3_BYTE_3         3 // NFC_BLK_ID_DATA: used as 'data valid'</span>
<a name="l00354"></a><a class="code" href="a00061.html#7c529432302c1504305d86773d1ae0a7">00354</a> <span class="preprocessor"></span><span class="preprocessor">#define NFC_OFST_3_DATA_SRC                0x00    // Identify a source block (recovery)</span>
<a name="l00355"></a><a class="code" href="a00061.html#98a49853a649a262cd8c415d568e92f3">00355</a> <span class="preprocessor"></span><span class="preprocessor">#define NFC_OFST_3_DATA_DST                0xFF    // Identify a recipient block (recovery)</span>
<a name="l00356"></a>00356 <span class="preprocessor"></span>
<a name="l00357"></a><a class="code" href="a00061.html#a36ea238247cfc24264d4fd936b53e08">00357</a> <span class="preprocessor">#define NFC_SPARE_OFST_4_BYTE_4         4</span>
<a name="l00358"></a><a class="code" href="a00061.html#5df984b9f7ef87bb85401f4fb7978908">00358</a> <span class="preprocessor"></span><span class="preprocessor">#define NFC_OFST_4_FBB_DRIVER_RELEASE      0x01    // Current NF release. When a new firmware implies that LUT and FBB must be rebuild, just increment this number.</span>
<a name="l00359"></a><a class="code" href="a00061.html#ee5e2777710c4535183e1791a4dfdc64">00359</a> <span class="preprocessor"></span><span class="preprocessor">#define NFC_SPARE_DATA_VALID    0xFF</span>
<a name="l00360"></a><a class="code" href="a00061.html#73da490f34dbbdb8f21005f7fb708e42">00360</a> <span class="preprocessor"></span><span class="preprocessor">#define NFC_SPARE_DATA_INVALID     0</span>
<a name="l00361"></a><a class="code" href="a00061.html#391ff58f6f81da0da062a288ed96d847">00361</a> <span class="preprocessor"></span><span class="preprocessor">#define NFC_SPARE_OFST_EXPORT          11</span>
<a name="l00362"></a>00362 <span class="preprocessor"></span>
<a name="l00363"></a><a class="code" href="a00061.html#541bc42ea0ce5ece317663b6330270e1">00363</a> <span class="preprocessor">#define NFC_SPARE_OFST_6_LBA            6 // and 7</span>
<a name="l00364"></a><a class="code" href="a00061.html#6fd751d12dbd6e385f256152224b6635">00364</a> <span class="preprocessor"></span><span class="preprocessor">#define NFC_OFST_6_FBB_VALID    0xFF</span>
<a name="l00365"></a><a class="code" href="a00061.html#368c0bb974ad49ad58ab016d8a7f93bb">00365</a> <span class="preprocessor"></span><span class="preprocessor">#define NFC_OFST_6_FBB_INVALID     0</span>
<a name="l00366"></a>00366 <span class="preprocessor"></span>
<a name="l00367"></a><a class="code" href="a00061.html#fb32792772f53d535a51f8a41da8eba4">00367</a> <span class="preprocessor">#define NFC_SPARE_OFST_ECC2             8 // and 9, 10</span>
<a name="l00368"></a><a class="code" href="a00061.html#9b1d5140f23bee8a0de2fc1dc29e21ee">00368</a> <span class="preprocessor"></span><span class="preprocessor">#define NFC_SPARE_OFST_ECC1            13 // and 14, 15</span>
<a name="l00369"></a>00369 <span class="preprocessor"></span>
<a name="l00370"></a>00370 <span class="preprocessor">#if( NF_BAD_CONFIG==(FALSE) )</span>
<a name="l00371"></a>00371 <span class="preprocessor"></span><span class="preprocessor">#  if (NF_GENERIC_DRIVER==TRUE) || (NF_AUTO_DETECT_2KB==TRUE) || (NF_AUTO_DETECT_512B==TRUE)</span>
<a name="l00372"></a>00372 <span class="preprocessor"></span>      <a class="code" href="a00061.html#d4d03be3b8f3d15ed804170a1311ec98">_GLOBEXT_</a> <a class="code" href="a00032.html#35d552e8456cfb2b810baa0a9212c98e">_MEM_TYPE_SLOW_</a> <a class="code" href="a00032.html#3cb25ca6f51f003950f9625ff05536fc">U8</a>   <a class="code" href="a00061.html#61fea0ce6f891274490f59384e7a21de">g_n_zones</a>          ; <span class="comment">// number of zones (=1024 blocks) per device</span>
<a name="l00373"></a>00373       <a class="code" href="a00061.html#d4d03be3b8f3d15ed804170a1311ec98">_GLOBEXT_</a> <a class="code" href="a00032.html#35d552e8456cfb2b810baa0a9212c98e">_MEM_TYPE_SLOW_</a> <a class="code" href="a00032.html#df928e51a60dba0df29d615401cc55a8">U16</a>  <a class="code" href="a00061.html#a77d29865677c8e97bbd578eac48be3f">g_n_blocks</a>         ; <span class="comment">// number of blocks per device</span>
<a name="l00374"></a>00374       <a class="code" href="a00061.html#d4d03be3b8f3d15ed804170a1311ec98">_GLOBEXT_</a> <a class="code" href="a00032.html#bf669e579471cadcf68d9ffc440e68b1">_MEM_TYPE_FAST_</a> <a class="code" href="a00032.html#3cb25ca6f51f003950f9625ff05536fc">U8</a>   <a class="code" href="a00061.html#4d7c730b3cd399426d94328236980166">g_n_row_cycles</a>     ; <span class="comment">// number of row cycles to access a page of the NF memory</span>
<a name="l00375"></a>00375       <a class="code" href="a00061.html#d4d03be3b8f3d15ed804170a1311ec98">_GLOBEXT_</a> <a class="code" href="a00032.html#35d552e8456cfb2b810baa0a9212c98e">_MEM_TYPE_SLOW_</a> <a class="code" href="a00032.html#3cb25ca6f51f003950f9625ff05536fc">U8</a>   <a class="code" href="a00061.html#704f58e28283f1a6539d4ebcf52d2be8">g_copy_back_cont</a>   ; <span class="comment">// 0 = copy back not supported, N = number of    CONTINUE subdivision contraint on copyback</span>
<a name="l00376"></a>00376       <a class="code" href="a00061.html#d4d03be3b8f3d15ed804170a1311ec98">_GLOBEXT_</a> <a class="code" href="a00032.html#35d552e8456cfb2b810baa0a9212c98e">_MEM_TYPE_SLOW_</a> <a class="code" href="a00032.html#3cb25ca6f51f003950f9625ff05536fc">U8</a>   <a class="code" href="a00061.html#ccd4688c7bedb0ceeb4b3b4d4a78c92a">g_copy_back_discont</a>; <span class="comment">// 0 = copy back not supported, N = number of DISCONTINUE subdivision contraint on copyback</span>
<a name="l00377"></a>00377       <a class="code" href="a00061.html#d4d03be3b8f3d15ed804170a1311ec98">_GLOBEXT_</a>                 <a class="code" href="a00032.html#253b248072cfc8bd812c69acd0046eed">Bool</a> <a class="code" href="a00061.html#7e776f74effed1ef2372393ca5cded60">g_cache_program</a>    ; <span class="comment">// 1 = cache program supported, 0 = not supported</span>
<a name="l00378"></a>00378       <a class="code" href="a00061.html#d4d03be3b8f3d15ed804170a1311ec98">_GLOBEXT_</a>                 <a class="code" href="a00032.html#253b248072cfc8bd812c69acd0046eed">Bool</a> <a class="code" href="a00061.html#4f97a48cb3ad4cb94aa358a5e5201b76">g_ce_toggle</a>           ; <span class="comment">// tell if CE must be low during read cycle or not                                                            </span>
<a name="l00379"></a>00379       <a class="code" href="a00061.html#d4d03be3b8f3d15ed804170a1311ec98">_GLOBEXT_</a> <a class="code" href="a00032.html#35d552e8456cfb2b810baa0a9212c98e">_MEM_TYPE_SLOW_</a> <a class="code" href="a00032.html#3cb25ca6f51f003950f9625ff05536fc">U8</a>   <a class="code" href="a00061.html#7176fd8ca68947e606bfb2574f6612d1">g_clock_dfc_nfc</a>    ; <span class="comment">// Clock of dfc and nfc</span>
<a name="l00380"></a>00380       <a class="code" href="a00061.html#d4d03be3b8f3d15ed804170a1311ec98">_GLOBEXT_</a> <a class="code" href="a00032.html#35d552e8456cfb2b810baa0a9212c98e">_MEM_TYPE_SLOW_</a> <a class="code" href="a00032.html#3cb25ca6f51f003950f9625ff05536fc">U8</a>   <a class="code" href="a00061.html#f1988bb3020968301cdb41696b569c0c">g_dev_maker</a>        ; <span class="comment">// Device maker</span>
<a name="l00381"></a>00381       <a class="code" href="a00061.html#d4d03be3b8f3d15ed804170a1311ec98">_GLOBEXT_</a> <a class="code" href="a00032.html#35d552e8456cfb2b810baa0a9212c98e">_MEM_TYPE_SLOW_</a> <a class="code" href="a00032.html#3cb25ca6f51f003950f9625ff05536fc">U8</a>   <a class="code" href="a00061.html#a18d841aa5fc7d3706489403ad06529a">g_dev_id</a>           ; <span class="comment">// Device ID</span>
<a name="l00382"></a><a class="code" href="a00061.html#55533de21e4e26eacb813e07cb1150b0">00382</a> <span class="preprocessor">#     define G_N_ZONES                 g_n_zones</span>
<a name="l00383"></a><a class="code" href="a00061.html#21e40fac2f3e76ae00f24b91301882c6">00383</a> <span class="preprocessor"></span><span class="preprocessor">#     define G_N_BLOCKS                g_n_blocks</span>
<a name="l00384"></a><a class="code" href="a00061.html#26193f60c442075fc7fdf8022b04c489">00384</a> <span class="preprocessor"></span><span class="preprocessor">#     define G_N_ROW_CYCLES            g_n_row_cycles</span>
<a name="l00385"></a><a class="code" href="a00061.html#7c58fe9f6485fa8f05d7198ab500179d">00385</a> <span class="preprocessor"></span><span class="preprocessor">#     define G_COPY_BACK_CONT          g_copy_back_cont</span>
<a name="l00386"></a><a class="code" href="a00061.html#8ba6ce5d7c8560f7c591a66516e167ac">00386</a> <span class="preprocessor"></span><span class="preprocessor">#     define G_COPY_BACK_DISCONT       g_copy_back_discont</span>
<a name="l00387"></a><a class="code" href="a00061.html#b4233cf2358424060e6586b4ca401213">00387</a> <span class="preprocessor"></span><span class="preprocessor">#     define G_CACHE_PROG              g_cache_program</span>
<a name="l00388"></a><a class="code" href="a00061.html#1294603227ee6dda5d13ee630f7b7415">00388</a> <span class="preprocessor"></span><span class="preprocessor">#     define G_CE_TOGGLE               g_ce_toggle</span>
<a name="l00389"></a><a class="code" href="a00061.html#02a8a44f37b2e7779254db91d3f9db39">00389</a> <span class="preprocessor"></span><span class="preprocessor">#     define G_CLK_DFC_NFC             g_clock_dfc_nfc</span>
<a name="l00390"></a><a class="code" href="a00061.html#8fe0d788080aeed45f883b09ab26c2d4">00390</a> <span class="preprocessor"></span><span class="preprocessor">#     define G_DEV_MAKER               g_dev_maker</span>
<a name="l00391"></a><a class="code" href="a00061.html#fe78dc9100a7cabc360db6885f1daaec">00391</a> <span class="preprocessor"></span><span class="preprocessor">#     define G_DEV_ID                  g_dev_id</span>
<a name="l00392"></a>00392 <span class="preprocessor"></span><span class="preprocessor">#  else</span>
<a name="l00393"></a>00393 <span class="preprocessor"></span><span class="preprocessor">#     define G_N_ZONES                 (NF_N_ZONES)</span>
<a name="l00394"></a>00394 <span class="preprocessor"></span><span class="preprocessor">#     define G_N_BLOCKS                (NF_N_BLOCKS)</span>
<a name="l00395"></a>00395 <span class="preprocessor"></span><span class="preprocessor">#     define G_N_ROW_CYCLES            (NF_N_ROW_CYCLES)</span>
<a name="l00396"></a>00396 <span class="preprocessor"></span><span class="preprocessor">#     define G_COPY_BACK_CONT          (NF_COPYBACK_CONT)</span>
<a name="l00397"></a>00397 <span class="preprocessor"></span><span class="preprocessor">#     define G_COPY_BACK_DISCONT       (NF_COPYBACK_DISCONT)</span>
<a name="l00398"></a>00398 <span class="preprocessor"></span><span class="preprocessor">#     define G_CACHE_PROG              (NF_CACHE_PROGRAM)</span>
<a name="l00399"></a>00399 <span class="preprocessor"></span><span class="preprocessor">#     define G_CE_TOGGLE               (NF_CE_TOGGLE)</span>
<a name="l00400"></a>00400 <span class="preprocessor"></span><span class="preprocessor">#     define G_CLK_DFC_NFC             (CLK_DFC_NFC)</span>
<a name="l00401"></a>00401 <span class="preprocessor"></span><span class="preprocessor">#     define G_DEV_MAKER               (NF_DEV_MAKER)</span>
<a name="l00402"></a>00402 <span class="preprocessor"></span><span class="preprocessor">#     define G_DEV_ID                  (NF_DEV_ID)</span>
<a name="l00403"></a>00403 <span class="preprocessor"></span><span class="preprocessor">#  endif</span>
<a name="l00404"></a>00404 <span class="preprocessor"></span>
<a name="l00405"></a>00405 <span class="preprocessor">#  if (NF_GENERIC_DRIVER==TRUE)</span>
<a name="l00406"></a>00406 <span class="preprocessor"></span>      <a class="code" href="a00061.html#d4d03be3b8f3d15ed804170a1311ec98">_GLOBEXT_</a> <a class="code" href="a00032.html#bf669e579471cadcf68d9ffc440e68b1">_MEM_TYPE_FAST_</a> <a class="code" href="a00032.html#3cb25ca6f51f003950f9625ff05536fc">U8</a>   <a class="code" href="a00061.html#12e3a20682ed5032e788a57882f8256f">g_shift_page_byte</a>  ; <span class="comment">// (1&lt;&lt;n) size of page,   unit in bytes</span>
<a name="l00407"></a>00407       <a class="code" href="a00061.html#d4d03be3b8f3d15ed804170a1311ec98">_GLOBEXT_</a> <a class="code" href="a00032.html#bf669e579471cadcf68d9ffc440e68b1">_MEM_TYPE_FAST_</a> <a class="code" href="a00032.html#3cb25ca6f51f003950f9625ff05536fc">U8</a>   <a class="code" href="a00061.html#be82d871b5e412806adb94589b4b7f2e">g_shift_block_page</a> ; <span class="comment">// (1&lt;&lt;n) size of physical block,  unit in pages</span>
<a name="l00408"></a>00408       <a class="code" href="a00061.html#d4d03be3b8f3d15ed804170a1311ec98">_GLOBEXT_</a> <a class="code" href="a00032.html#35d552e8456cfb2b810baa0a9212c98e">_MEM_TYPE_SLOW_</a> <a class="code" href="a00032.html#3cb25ca6f51f003950f9625ff05536fc">U8</a>   <a class="code" href="a00061.html#b466843403d37526c75306381a6807c7">g_ofst_blk_status</a>  ; <span class="comment">// Offset of Block Status information in spare zone</span>
<a name="l00409"></a><a class="code" href="a00061.html#db2af259f2983b78d8cf4fac62afaf7d">00409</a> <span class="preprocessor">#     define Is_nf_2k()              (11==g_shift_page_byte )</span>
<a name="l00410"></a><a class="code" href="a00061.html#dcb60d50b5764fc609ef291064f0eda3">00410</a> <span class="preprocessor"></span><span class="preprocessor">#     define Is_not_nf_2k()          (11!=g_shift_page_byte )</span>
<a name="l00411"></a><a class="code" href="a00061.html#d1213b7a82a55a9d9addaef5cd33ee69">00411</a> <span class="preprocessor"></span><span class="preprocessor">#     define Is_nf_512()             ( 9==g_shift_page_byte )</span>
<a name="l00412"></a><a class="code" href="a00061.html#1807031055d9d07f3229cb8d826d3ffc">00412</a> <span class="preprocessor"></span><span class="preprocessor">#     define Is_not_nf_512()         ( 9!=g_shift_page_byte )</span>
<a name="l00413"></a><a class="code" href="a00061.html#0bc54ae60cf42f5064c0a90cfca229cf">00413</a> <span class="preprocessor"></span><span class="preprocessor">#     define G_SHIFT_BLOCK_PAGE        g_shift_block_page</span>
<a name="l00414"></a><a class="code" href="a00061.html#bff7cf7d50c8eed7cb6122155aed8f3b">00414</a> <span class="preprocessor"></span><span class="preprocessor">#     define G_SHIFT_PAGE_BYTE         g_shift_page_byte</span>
<a name="l00415"></a><a class="code" href="a00061.html#e0e77dabaa2dc4bdde63fa552f44e745">00415</a> <span class="preprocessor"></span><span class="preprocessor">#     define G_OFST_BLK_STATUS         g_ofst_blk_status</span>
<a name="l00416"></a><a class="code" href="a00061.html#c0f49b3b35f158892b2d8695c1d1f705">00416</a> <span class="preprocessor"></span><span class="preprocessor">#     define NF_SPARE_POS              ( Is_nf_2k() ? 2048 : 512 )</span>
<a name="l00417"></a><a class="code" href="a00061.html#cab1cd545a6af56cc962fe3f25c72ac8">00417</a> <span class="preprocessor"></span><span class="preprocessor">#     define NF_N_GOOD_STATIC_BLOCK    ( Is_nf_2k() ?   32 : 256 )</span>
<a name="l00418"></a>00418 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00419"></a>00419 <span class="preprocessor"></span><span class="preprocessor">#     if (NF_SHIFT_PAGE_BYTE==11) // 2KB pages</span>
<a name="l00420"></a>00420 <span class="preprocessor"></span><span class="preprocessor">#        define Is_nf_2k()      ( TRUE  )</span>
<a name="l00421"></a>00421 <span class="preprocessor"></span><span class="preprocessor">#        define Is_not_nf_2k()  ( FALSE )</span>
<a name="l00422"></a>00422 <span class="preprocessor"></span><span class="preprocessor">#        define Is_nf_512()     ( FALSE )</span>
<a name="l00423"></a>00423 <span class="preprocessor"></span><span class="preprocessor">#        define Is_not_nf_512() ( TRUE  )</span>
<a name="l00424"></a>00424 <span class="preprocessor"></span><span class="preprocessor">#        define NF_SPARE_POS         2048  // Spare zone starts at this byte offset in the page</span>
<a name="l00425"></a>00425 <span class="preprocessor"></span><span class="preprocessor">#        define NF_N_GOOD_STATIC_BLOCK 32  // Number of the *valid* blocks in the static area</span>
<a name="l00426"></a>00426 <span class="preprocessor"></span><span class="preprocessor">#        define G_OFST_BLK_STATUS       0  // Offset of the Bad Block information in spare zone</span>
<a name="l00427"></a>00427 <span class="preprocessor"></span><span class="preprocessor">#     endif</span>
<a name="l00428"></a>00428 <span class="preprocessor"></span><span class="preprocessor">#     if (NF_SHIFT_PAGE_BYTE==9) // 512B pages</span>
<a name="l00429"></a>00429 <span class="preprocessor"></span><span class="preprocessor">#        define Is_nf_2k()        ( FALSE )</span>
<a name="l00430"></a>00430 <span class="preprocessor"></span><span class="preprocessor">#        define Is_not_nf_2k()    ( TRUE  )</span>
<a name="l00431"></a>00431 <span class="preprocessor"></span><span class="preprocessor">#        define Is_nf_512()       ( TRUE  )</span>
<a name="l00432"></a>00432 <span class="preprocessor"></span><span class="preprocessor">#        define Is_not_nf_512()   ( FALSE )</span>
<a name="l00433"></a>00433 <span class="preprocessor"></span><span class="preprocessor">#        define NF_SPARE_POS           512  // Spare zone starts at this byte offset in the page</span>
<a name="l00434"></a>00434 <span class="preprocessor"></span><span class="preprocessor">#        define NF_N_GOOD_STATIC_BLOCK 256  // Number of the *valid* blocks in the static area</span>
<a name="l00435"></a>00435 <span class="preprocessor"></span><span class="preprocessor">#        define G_OFST_BLK_STATUS        5  // Offset of the Bad Block information in spare zone</span>
<a name="l00436"></a>00436 <span class="preprocessor"></span><span class="preprocessor">#     endif</span>
<a name="l00437"></a>00437 <span class="preprocessor"></span><span class="preprocessor">#     define G_SHIFT_BLOCK_PAGE        (NF_SHIFT_BLOCK_PAGE)</span>
<a name="l00438"></a>00438 <span class="preprocessor"></span><span class="preprocessor">#     define G_SHIFT_PAGE_BYTE         (NF_SHIFT_PAGE_BYTE)</span>
<a name="l00439"></a>00439 <span class="preprocessor"></span><span class="preprocessor">#  endif</span>
<a name="l00440"></a>00440 <span class="preprocessor"></span>
<a name="l00441"></a>00441 <span class="preprocessor">#endif // NF_BAD_CONFIG</span>
<a name="l00442"></a>00442 <span class="preprocessor"></span>
<a name="l00443"></a>00443 <span class="comment">//_____ F U N C T I O N S __________________________________________________</span>
<a name="l00444"></a>00444 
<a name="l00445"></a>00445 <span class="comment">// Values used by "nfc_detect" fonction</span>
<a name="l00446"></a><a class="code" href="a00061.html#56789fa8d78f2dc5fc1c2c95d7f9fb83">00446</a> <span class="preprocessor">#define     NO_NF_CONNECTED   0xFF</span>
<a name="l00447"></a><a class="code" href="a00061.html#d86057b9c0e0585bc03215515ce28f5f">00447</a> <span class="preprocessor"></span><span class="preprocessor">#define     NF_UNKNOW         0xFE</span>
<a name="l00448"></a>00448 <span class="preprocessor"></span>
<a name="l00449"></a>00449 <span class="comment">// Functions prototypes</span>
<a name="l00450"></a>00450 
<a name="l00451"></a>00451 <span class="keywordtype">void</span>        <a class="code" href="a00060.html#2888ee8b7b2aad2f3e86eeff599729ca" title="Enable the XMCR (Extending Memory Module) of the AVR to drive the NAND Flash.">nf_XMCR_enable</a>(       <span class="keywordtype">void</span> );
<a name="l00452"></a>00452 <span class="keywordtype">void</span>        <a class="code" href="a00060.html#6008aafe936bca7bfc39a8db231c1e7b" title="Disable the XMCR module of the AVR, to allow access to others peripherals that may...">nf_XMCR_disable</a>(      <span class="keywordtype">void</span> );
<a name="l00453"></a>00453 <span class="keywordtype">void</span>        <a class="code" href="a00060.html#2bd4c6ceb672b91624859e1f4bec04ac">nfc_select_dev</a>( <a class="code" href="a00032.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> dev );
<a name="l00454"></a>00454 <span class="keywordtype">void</span>        <a class="code" href="a00061.html#0d84ba3390ed57d612c9b3cbc6c04286">nfc_init</a>(             <a class="code" href="a00032.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> nb_dev, <a class="code" href="a00032.html#df928e51a60dba0df29d615401cc55a8">U16</a> last_protected_block );
<a name="l00455"></a>00455 <a class="code" href="a00032.html#a95502d3ad090c7564841b21b6aedcee">Status_bool</a> <a class="code" href="a00060.html#ef97b996828cba45aa7ee961af28e036" title="Check the status of the selected device.">nfc_check_status</a>(     <span class="keywordtype">void</span> );
<a name="l00456"></a>00456 <a class="code" href="a00032.html#3cb25ca6f51f003950f9625ff05536fc">U8</a>          <a class="code" href="a00060.html#455d3b498da0863662f3309643c2b719" title="Tests the Nand Flash configuration.">nfc_check_type</a>(       <a class="code" href="a00032.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> nb_dev );
<a name="l00457"></a>00457 <span class="keywordtype">void</span>        <a class="code" href="a00060.html#ec96d29ad256f2dfc2ebfceddf08d6a9" title="Reset all the NF devices.">nfc_reset_nands</a>(      <a class="code" href="a00032.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> nb_dev );
<a name="l00458"></a>00458 <span class="keywordtype">void</span>        <a class="code" href="a00060.html#a0a322a0237ff247248591adb2b10fab" title="Opens a page for read.">nfc_open_page_read</a>(   <a class="code" href="a00032.html#811024d35b9b8a41095b1f583b649e56">U32</a> page_addr, <a class="code" href="a00032.html#df928e51a60dba0df29d615401cc55a8">U16</a> byte_addr);
<a name="l00459"></a>00459 <span class="keywordtype">void</span>        <a class="code" href="a00060.html#856b5ae1fade14e11da35fd5109fda8c" title="Opens a page for write.">nfc_open_page_write</a>(  <a class="code" href="a00032.html#811024d35b9b8a41095b1f583b649e56">U32</a> page_addr, <a class="code" href="a00032.html#df928e51a60dba0df29d615401cc55a8">U16</a> byte_addr);
<a name="l00460"></a>00460 <span class="keywordtype">void</span>        <a class="code" href="a00060.html#baa6a09d1819325c231e3735177a2179" title="Mark a block as &amp;#39;invalid&amp;#39; by clearing it entirely.">nfc_mark_bad_block</a>(   <a class="code" href="a00032.html#811024d35b9b8a41095b1f583b649e56">U32</a> page_addr );
<a name="l00461"></a>00461 <span class="keywordtype">void</span>        <a class="code" href="a00060.html#4a7f7eed66f5eb678e4a96ae5dc32486" title="Erases a block.">nfc_erase_block</a>(      <a class="code" href="a00032.html#811024d35b9b8a41095b1f583b649e56">U32</a> page_addr, <a class="code" href="a00032.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> force_erase );
<a name="l00462"></a>00462 <span class="keywordtype">void</span>        <a class="code" href="a00060.html#b9ba38cddb62690e76858546804fac2c" title="Prepare a copy-back session.">nfc_copy_back_init</a>(   <a class="code" href="a00032.html#811024d35b9b8a41095b1f583b649e56">U32</a> page_addr );
<a name="l00463"></a>00463 <span class="keywordtype">void</span>        <a class="code" href="a00061.html#f172475aee374f6742159a2bfb9b333b">nfc_copy_back_conf</a>(   <a class="code" href="a00032.html#811024d35b9b8a41095b1f583b649e56">U32</a> page_addr );
<a name="l00464"></a>00464 <a class="code" href="a00032.html#811024d35b9b8a41095b1f583b649e56">U32</a>         <a class="code" href="a00060.html#2d5cf1d9c2243be1a253d5b0fd9147dd" title="Read the ID of the Nand-Flash.">nfc_read_id</a>(          <a class="code" href="a00032.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> read_id_cmd, <a class="code" href="a00032.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> nf_num );
<a name="l00465"></a>00465 <a class="code" href="a00032.html#3cb25ca6f51f003950f9625ff05536fc">U8</a>          <a class="code" href="a00060.html#257fa3cbd1bd671a438dad76c52d4365" title="Read the ID of the Nand-Flash and update the global variable.">nfc_detect</a>(           <span class="keywordtype">void</span> );
<a name="l00466"></a>00466 <span class="keywordtype">void</span>        <a class="code" href="a00060.html#479efac38d042c2f27684ec8087da576" title="Tests the true busy.">nfc_wait_busy</a>(        <span class="keywordtype">void</span> );
<a name="l00467"></a>00467 
<a name="l00468"></a>00468 <span class="keywordtype">void</span>        <a class="code" href="a00060.html#37641716cd31a827e214a2d0ec1f5c66" title="Reads the number spare bytes specified and stores them in a array.">nfc_read_spare_byte</a>(
<a name="l00469"></a>00469    <a class="code" href="a00032.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> <a class="code" href="a00032.html#35d552e8456cfb2b810baa0a9212c98e">_MEM_TYPE_SLOW_</a> * p_byte
<a name="l00470"></a>00470 ,  <a class="code" href="a00032.html#3cb25ca6f51f003950f9625ff05536fc">U8</a>  n_byte
<a name="l00471"></a>00471 ,  <a class="code" href="a00032.html#811024d35b9b8a41095b1f583b649e56">U32</a> page_addr
<a name="l00472"></a>00472 );
<a name="l00473"></a>00473 
<a name="l00474"></a>00474 <span class="keywordtype">void</span>        <a class="code" href="a00061.html#fc4fa239b80b2467d96653e379f2c473">nfc_print_block</a>(      <a class="code" href="a00032.html#df928e51a60dba0df29d615401cc55a8">U16</a> block_addr, <a class="code" href="a00032.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> dev_id);
<a name="l00475"></a>00475 
<a name="l00476"></a>00476 <span class="preprocessor">#endif  // _NFC_DRV_H_</span>
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Mon Sep 14 13:14:18 2009 for ATMEL by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.3 </small></address>
</body>
</html>
